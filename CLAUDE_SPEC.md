ä»¥ä¸‹ã¯ã€\*\*VSâ€¯Codeâ€¯æ‹¡å¼µæ©Ÿèƒ½ï¼ˆã¾ãšã¯â€¯Bunâ€¯+â€¯TypeScriptã€å¿…è¦ãªã‚‰ npm ã§ã‚‚ãƒ“ãƒ«ãƒ‰å¯èƒ½ï¼‰\*\*ã¨ã—ã¦å®Ÿè£…ã™ã‚‹ãŸã‚ã®è©³ç´°ãªä»•æ§˜æ›¸ã§ã™ã€‚

---

## 1. æ¦‚è¦

| é …ç›®     | å†…å®¹                                                                                             |
| ------ | ---------------------------------------------------------------------------------------------- |
| ãƒ„ãƒ¼ãƒ«å   | **`claude-worktree-manager`**                                                                  |
| ç›®çš„     | ClaudeÂ Codeâ€¯YOLO ãƒ¢ãƒ¼ãƒ‰ã‚’ **å®‰å…¨ãƒ»ç°¡å˜** ã«ä½¿ã†ãŸã‚ã® VSâ€¯Code ã‚µã‚¤ãƒ‰ãƒãƒ¼æ‹¡å¼µ                                         |
| ä¸»ãªæ©Ÿèƒ½   | GitÂ worktree ã®ç”Ÿæˆ/ãƒãƒ¼ã‚¸/å‰Šé™¤ã€`.devcontainer` é››å½¢ç”Ÿæˆã€VSâ€¯Code ã§ devcontainer ã‚’å³åº§ã«é–‹ãã€ç’°å¢ƒå¤‰æ•°ã®è‡ªå‹•ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼        |
| å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ | GitÂ worktreeãƒ»devcontainer ã®æ“ä½œã«ä¸æ…£ã‚Œãªé–‹ç™ºè€…ï¼éã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢                                                   |
| ã‚³ã‚¢æŠ€è¡“   | Bunâ€¯v1.2+ / Node18 ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã€TypeScriptã€VSâ€¯Code ExtensionÂ APIã€ShellJSï¼ˆç°¡æ˜“ Git æ“ä½œï¼‰,â€¯esbuild (Bun å†…è”µ) |

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
claude-worktree-manager/
â”œâ”€ src/
â”‚  â”œâ”€ extension.ts         # æ‹¡å¼µæ©Ÿèƒ½ã‚¨ãƒ³ãƒˆãƒª
â”‚  â”œâ”€ treeView.ts          # ã‚µã‚¤ãƒ‰ãƒãƒ¼ UI Provider
â”‚  â”œâ”€ commands/
â”‚  â”‚   â”œâ”€ createWorktree.ts
â”‚  â”‚   â”œâ”€ mergeWorktree.ts
â”‚  â”‚   â”œâ”€ deleteWorktree.ts
â”‚  â”‚   â”œâ”€ generateDevcontainer.ts
â”‚  â”‚   â””â”€ openDevcontainer.ts
â”‚  â””â”€ utils/
â”‚      â”œâ”€ git.ts           # Git / worktree ãƒ©ãƒƒãƒ‘
â”‚      â”œâ”€ fs.ts            # ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œãƒ˜ãƒ«ãƒ‘
â”‚      â””â”€ env.ts           # ç’°å¢ƒå¤‰æ•°å±•é–‹ãƒ˜ãƒ«ãƒ‘
â”œâ”€ templates/
â”‚  â”œâ”€ devcontainer.json    # ãƒŸãƒ‹ãƒãƒ é››å½¢ï¼ˆç’°å¢ƒå¤‰æ•°ã¯ã‚³ãƒ¼ãƒ‰ã§æ³¨å…¥ï¼‰
â”‚  â”œâ”€ Dockerfile
â”‚  â”œâ”€ init-firewall.sh
â”‚  â””â”€ CLAUDE.md            # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ”ãƒ¼ç”¨
â”œâ”€ package.json            # npm fallback ç”¨
â”œâ”€ bunfig.toml             # Bun ãƒ“ãƒ«ãƒ‰è¨­å®š
â”œâ”€ tsconfig.json
â””â”€ README.md / DEVELOPER.md
```

> **Bunâ€¯ã®ã¿ã§å®Œçµ**ã•ã›ã‚‹å ´åˆã¯ `bun bun`ã€€(= Bun ã®ãƒ“ãƒ«ãƒ‰ï¼†æ‹¡å¼µãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å‡ºåŠ›) ã‚’æ¡ç”¨ã€‚npm äº’æ›æ€§ã‚’é‡è¦–ã™ã‚‹å ´åˆã¯ `npm run package` ã‚’è¿½åŠ ã—ã¾ã™ã€‚
> *VSÂ Code ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ãƒ¼ã‚¹å…¬é–‹æ™‚ã¯ Node18 ãƒãƒ³ãƒ‰ãƒ«ãŒå¿…é ˆ* ãªã®ã§ã€Bunâ†’esbuild ã§Â `.vsix`Â ã‚’ç”Ÿæˆã—ã€ä¾å­˜é–¢ä¿‚ã‚’ node\_modules ã”ã¨åŒæ¢±ã™ã‚‹æ§‹æˆã‚’æ¨å¥¨ã—ã¾ã™ã€‚

---

## 3. æ©Ÿèƒ½ä»•æ§˜

### 3.1 GitÂ worktree æ“ä½œ

| æ©Ÿèƒ½  | èª¬æ˜                                                          | ã‚³ãƒãƒ³ãƒ‰ ID                 | ä¸»è¦å…¥åŠ›                                           |
| --- | ----------------------------------------------------------- | ----------------------- | ---------------------------------------------- |
| ç”Ÿæˆ  | worktree ã‚’æŒ‡å®šãƒ‘ã‚¹ã«ä½œæˆã—ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ `.devcontainer` ã¨ `CLAUDE.md` ã‚’é…ç½® | `claude.createWorktree` | ãƒ–ãƒ©ãƒ³ãƒåã€ãƒ‘ã‚¹ã€`--withDevcontainer`ã€`--withClaudeMd` |
| ãƒãƒ¼ã‚¸ | worktree ãƒ–ãƒ©ãƒ³ãƒã‚’è¦ªãƒ–ãƒ©ãƒ³ãƒã¸ãƒãƒ¼ã‚¸ã€‚å®Œäº†å¾Œ worktree ã‚’å‰Šé™¤ã™ã‚‹ã‹é¸æŠå¯              | `claude.mergeWorktree`  | å¯¾è±¡ worktree                                    |
| å‰Šé™¤  | ä¸è¦ãª worktree ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ GitÂ å‚ç…§ã‚’å®‰å…¨ã«å‰Šé™¤                           | `claude.deleteWorktree` | å¯¾è±¡ worktree                                    |

> **å®‰å…¨è£…ç½®**
>
> * ãƒãƒ¼ã‚¸å‰ã« `git status --porcelain` ã‚’å®Ÿè¡Œã—ã€æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯ UI ã§è­¦å‘Š
> * `--force` ç›¸å½“ã®æ“ä½œã¯æ‹¡å¼µå´ã§æ˜ç¤ºçš„ã«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ç¢ºèª

### 3.2 `.devcontainer` é››å½¢ç”Ÿæˆ

1. `templates/devcontainer.json` ã‚’ã‚³ãƒ”ãƒ¼
2. `containerEnv` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¸‹è¨˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§å‹•çš„æŒ¿å…¥

   * `${localEnv:VAR_NAME}` å½¢å¼ã§æ›¸ãè¾¼ã‚€
3. `Dockerfile` ã¨ `init-firewall.sh` ã‚‚åŒæ™‚ã‚³ãƒ”ãƒ¼

> GitHub ä¸Šæµ (anthropics/claude-code) ãŒæ›´æ–°ã•ã‚ŒãŸéš›ã¯ **é€±æ¬¡ CI** ã§å·®åˆ†æ¤œçŸ¥â†’ãƒ†ãƒ³ãƒ—ãƒ¬æ›´æ–°ã™ã‚‹ GitHubÂ Actions ã‚’åˆ¥ãƒªãƒã‚¸ãƒˆãƒªã§ç”¨æ„ã™ã‚‹ã¨ä¿å®ˆãŒæ¥½ã§ã™ã€‚

### 3.3 devcontainer ã®è‡ªå‹•ã‚ªãƒ¼ãƒ—ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³      | å‹•ä½œ                                                    |
| ---------- | ----------------------------------------------------- |
| **åŒã‚¦ã‚£ãƒ³ãƒ‰ã‚¦** | `vscode.openFolder(path, { forceReuseWindow: true })` |
| **æ–°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦** | `vscode.openFolder(path, { forceNewWindow: true })`   |

> `.code-workspace` ã‚’çµŒç”±ã›ãšã€`AttachContainer` ã‚³ãƒãƒ³ãƒ‰ã‚’ Shell çµŒç”±ã§å©ãæ–¹æ³•ã¯éæ¨å¥¨ã€‚VSâ€¯CodeÂ 1.89 ä»¥é™ã¯ API ã§ç›´æ¥é–‹ã‘ã¾ã™ã€‚

### 3.4 ã‚µã‚¤ãƒ‰ãƒãƒ¼ UI (TreeÂ View)

```
cc-YOLOCON
â”œâ”€ Existing Worktrees
â”‚   â”œâ”€ feature/foo        (path)   [ğŸ—‘ï¸][â‡„]
â”‚   â””â”€ bugfix/bar         (path)   [ğŸ—‘ï¸][â‡„]
â”œâ”€ + Create New Worktree
â”œâ”€ + Generate .devcontainer
â””â”€ + Open in Devcontainer
```

* TreeItem ã® `contextValue` ã‚’ä½¿ã„ã€`when` æ¡ä»¶ã§ã‚¢ã‚¤ã‚³ãƒ³ä»˜ãã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’å®Ÿè£…
* `vscode.window.registerTreeDataProvider` + `vscode.commands.registerCommand` ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç´ä»˜ã‘

---

## 4. éæ©Ÿèƒ½è¦ä»¶

| é …ç›®          | è¦ä»¶                                                                                |
| ----------- | --------------------------------------------------------------------------------- |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹     | ä¸»è¦æ“ä½œã¯ 2â€¯ç§’ä»¥å†…ã« UI å¿œç­”ã€‚GitÂ worktree ç”Ÿæˆã¯ãƒ•ã‚¡ã‚¤ãƒ«æ•°â€¯5â€¯ä¸‡ä»¥ä¸‹ã§ã‚‚ 10â€¯ç§’ä»¥å†…                           |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£      | ç’°å¢ƒå¤‰æ•°ã‚’ãƒ­ã‚°å‡ºåŠ›ã—ãªã„ã€‚`claude --dangerously-skip-permissions` ã¯ devcontainer å†…é™å®šã§å®Ÿè¡Œ        |
| ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  | macOS / Linux / Windows (WSL2) ã‚’ã‚µãƒãƒ¼ãƒˆã€‚ãƒ‘ã‚¹åŒºåˆ‡ã‚Šã¯ `path.join` ã§æŠ½è±¡åŒ–                      |
| ãƒ†ã‚¹ãƒˆ         | Vitest + Bun ã§ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã€‚æœ€ä½ã‚«ãƒãƒ¬ãƒƒã‚¸ 80â€¯%                                                |
| CI/CD       | GitHubÂ Actions ã§<br>â‘  lint/test â†’ â‘¡Â `bun bunx vsce package` â†’ â‘¢ ReleaseÂ Artifacts |

---

## 5. ä¸»è¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª                     | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ (æ¨å¥¨) | ç”¨é€”                             |
| ------------------------- | ---------- | ------------------------------ |
| **Bun**                   | 1.2.x      | ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ©ãƒ³ã‚¿ã‚¤ãƒ                       |
| **@types/vscode**         | ^1.89.0    | VSâ€¯Code API å‹å®šç¾©                |
| **shelljs**               | ^0.8       | GitÂ wrapperï¼ˆchild\_process ä»£æ›¿ï¼‰ |
| **fs-extra**              | ^11        | ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ                         |
| **prettier** + **eslint** | æœ€æ–°         | ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ & Lint                  |
| **vitest**                | æœ€æ–°         | ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°                         |

---

## 6. å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

1. **Bun ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–**

   ```bash
   bun init
   bun add -d @types/vscode shelljs fs-extra vitest eslint prettier
   ```
2. **VSâ€¯Code æ‹¡å¼µé››å½¢ç”Ÿæˆ**

   ```bash
   bunx yo code --extensionType=ui --extensionName=claude-worktree-manager
   ```
3. **`bunfig.toml`** ã§ `"main": "dist/extension.js"` ã‚’å‡ºåŠ›
4. **TreeView & ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…**ï¼ˆ`src/` é…ä¸‹ï¼‰
5. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«** ã‚’ `templates/` ã«é…ç½®
6. **å˜ä½“ãƒ†ã‚¹ãƒˆ + ESLint / Prettier è¨­å®š**
7. **GitHub Actions** ã‚’ä½œæˆï¼ˆpull\_request / main push ã§å‹•ä½œï¼‰
8. **README.md / DEVELOPER.md** ã‚’ä¸‹è¨˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ä½œæˆ
9. **vsceâ€¯package** ã§ `.vsix` å‡ºåŠ›ã—ã€æ‰‹å…ƒã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
10. **ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ãƒ¼ã‚¹å…¬é–‹**ï¼ˆä»»æ„ï¼‰

---

## 7. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæŒ‡é‡

### 7.1 README.mdï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼‰

| ã‚»ã‚¯ã‚·ãƒ§ãƒ³       | å†…å®¹                                  |
| ----------- | ----------------------------------- |
| Overview    | æ‹¡å¼µæ©Ÿèƒ½ã®ç›®çš„ãƒ»ä¸»ãªä½¿ã„æ–¹ï¼ˆGIF ä»˜ãæ¨å¥¨ï¼‰             |
| QuickÂ Start | â‘  install â†’ â‘¡ ã‚µã‚¤ãƒ‰ãƒãƒ¼æ“ä½œ â†’ â‘¢ Claude èµ·å‹• |
| FAQ         | ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆ                    |

### 7.2 DEVELOPER.mdï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰

| ã‚»ã‚¯ã‚·ãƒ§ãƒ³    | å†…å®¹                            |
| -------- | ----------------------------- |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€  | ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«èª¬æ˜               |
| é–‹ç™ºãƒ•ãƒ­ãƒ¼    | `bun run watch`ã€ãƒ‡ãƒãƒƒã‚°æ–¹æ³• (`F5`) |
| ãƒªãƒªãƒ¼ã‚¹æ‰‹é †   | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä»˜ä¸ â†’ `bun run release`   |

---

## 8. ä»Šå¾Œã®æ‹¡å¼µä½™åœ°

* **CLI ãƒ¢ãƒ¼ãƒ‰**ï¼ˆ`bunx claude-wtm <subcommand>`ï¼‰ã§ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’ä½¿ã‚ãšé«˜é€Ÿæ“ä½œ
* **Worktree ãƒ†ãƒ³ãƒ—ãƒ¬åˆ‡æ›¿**: ç”Ÿæˆæ™‚ã« Dockerfile ãªã©ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºé¸æŠ
* **Claude Code è¨­å®š UI**: `settings.json` ã‚’ GUI ç·¨é›†

---

### ä»˜éŒ²Â A. `containerEnv` ç”Ÿæˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```ts
const ENV_KEYS = [
  "ANTHROPIC_API_KEY",
  "ANTHROPIC_AUTH_TOKEN",
  // ... (ä¸­ç•¥) ...
  "API_TIMEOUT_MS",
] as const;

export function generateContainerEnv(): Record<string, string> {
  return Object.fromEntries(
    ENV_KEYS.map((k) => [k, `\${localEnv:${k}}`])
  );
}
```

---
